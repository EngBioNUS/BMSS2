

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2. Simulate New Model &mdash; BMSS2 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3. Making a Model Selection Workflow" href="_Example_3nb.html" />
    <link rel="prev" title="1. Using the Database and Config Files" href="_Example_1nb.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> BMSS2
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="modules.html">BMSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html#working-with-sbml">Working with SBML</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html#examples">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="examples.html">Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="_Example_1nb.html">1. Using the Database and Config Files</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2. Simulate New Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Basic-Simulation">Basic Simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Plotting-extra-variables">Plotting extra variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Piecewise-Integration">Piecewise Integration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="_Example_3nb.html">3. Making a Model Selection Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="_Example_4nb.html">4. A Priori Identifiability Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="_Example_5nb.html">5. A Posteriori Identifiability Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="_Example_6nb.html">6. Sensitivity Analysis</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BMSS2</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="modules.html">BMSS</a> &raquo;</li>
        
          <li><a href="examples.html">Examples</a> &raquo;</li>
        
      <li>2. Simulate New Model</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/_Example_2nb.nblink.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="2.-Simulate-New-Model">
<h1>2. Simulate New Model<a class="headerlink" href="#2.-Simulate-New-Model" title="Permalink to this headline">¶</a></h1>
<p>In this example, we show you to perform a simple simulation in BMSS2.</p>
<div class="section" id="Basic-Simulation">
<h2>Basic Simulation<a class="headerlink" href="#Basic-Simulation" title="Permalink to this headline">¶</a></h2>
<p>The steps for analyzing a model not in the database are as follows:</p>
<ol class="arabic simple">
<li><p>Read the settngs file with BMSS.models.setup_sim.from_config</p></li>
<li><p>Read the core model file with BMSS.models.model_handler.from_config</p></li>
<li><p>Get the arguments required for analysis with BMSS.models.get_models_and_params</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span>  <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span>   <span class="nn">numba</span>   <span class="kn">import</span> <span class="n">jit</span>
<span class="kn">from</span>   <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>


<span class="kn">import</span> <span class="nn">BMSS.models.model_handler</span> <span class="k">as</span> <span class="nn">mh</span>
<span class="kn">import</span> <span class="nn">BMSS.models.setup_sim</span>     <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">BMSS.simulation</span>           <span class="k">as</span> <span class="nn">sim</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Connected to MBase_models, UBase_models
Connected to MBase_settings, UBase_settings
</pre></div></div>
</div>
<p>After importing the modules, we call the functions read the config files. These are files in .ini format where you specify the topology of the model and the settings for simulation and other types of analysis.</p>
<p>First we have the file that specifies the topology of the model</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[system_type]
system_type = TestModel, Dummy

[states]
states = m, p

[parameters]
parameters = k_ind, synm, degm, synp, degp

[inputs]
inputs = ind

[equations]
equations =
    dm = synm*ind/(ind + k_ind) - degm*m
    dp = synp*m - degp*p
</pre></div>
</div>
<p>Next we have the file which specifies the settings for simulation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[TestModel, Dummy]

init =
    m = [0, 1e-4],
    p = [0, 1e-4]

parameter_values =
    k_ind = [1e-2, 5e-2],
    synm  = [1e-5]*2,
    degm  = [0.015]*2,
    synp  = [1e-2]*2,
    degp  = [0.012]*2,
    ind   = [8e-2]*2

tspan =
    [0, 600, 61]

#Optional
solver_args =
    rtol   = 1.49012e-08,
    atol   = 1.49012e-08
</pre></div>
</div>
<p>Note: BMSS2 uses numpy’s <code class="docutils literal notranslate"><span class="pre">odeint</span></code> for integration. To tweak settings such as step size or tolerance, add an optional <code class="docutils literal notranslate"><span class="pre">solver_args</span></code> section in the settings file to specify the optional parameters of <code class="docutils literal notranslate"><span class="pre">odeint</span></code>. These include, rtol, atol, tcrit, h0, hmax, hmin, mxstep.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Read model</span>
<span class="n">core_model</span>       <span class="o">=</span> <span class="n">mh</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="s1">&#39;testmodel.ini&#39;</span><span class="p">)</span>
<span class="n">user_core_models</span> <span class="o">=</span> <span class="p">{</span><span class="n">core_model</span><span class="p">[</span><span class="s1">&#39;system_type&#39;</span><span class="p">]:</span> <span class="n">core_model</span><span class="p">}</span>

<span class="c1">#Read settings</span>
<span class="n">filename</span>    <span class="o">=</span> <span class="s1">&#39;settings_sim_1.ini&#39;</span>
<span class="n">config_data</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="c1">#Get arguments for simulation</span>
<span class="n">models</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">config_data</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">get_models_and_params</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">user_core_models</span><span class="o">=</span><span class="n">user_core_models</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>At this point, we can call perform the simulation by calling the integrate_models function.</p>
<p>The results of the integration are stored in ym as a nested dictionary in the form of ym[model_num][scenario_num][row] where row is a row index in params. Meanwhile, ym[model_num][0] contains the time array for the model. Thus, suppose we only have one model. ym will then have one key. If that model has 2 scenarios, ym[1] will have 2 keys not including 0. Finally, if there are two rows of parameters, ym[1][1] and ym[1][2] will have two keys each.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ym</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">integrate_models</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Keys in ym:&#39;</span><span class="p">,</span> <span class="n">ym</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Keys in ym[1]&#39;</span><span class="p">,</span> <span class="n">ym</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Keys in ym[1][1]&#39;</span><span class="p">,</span> <span class="n">ym</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulating models
Simulation complete
Keys in ym: dict_keys([1])
Keys in ym[1] dict_keys([1, 2, 0])
Keys in ym[1][1] dict_keys([0])
</pre></div></div>
</div>
<p>The following arguments follow a similar format to models where the first key corresponds to the model being integrated. The definition of the values indexed by those keys are as follows:</p>
<ul class="simple">
<li><p>plot_index : A list of state variables to plot as well as extra functions for plotting.</p></li>
<li><p>titles : A list of title names corresponding the states in plot_index. This argument is optional.</p></li>
<li><p>labels : A dict of scenario: name pairs that will be used in the legend. This argument is optional.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_index</span>  <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">],</span>
               <span class="p">}</span>
<span class="n">titles</span>      <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="s1">&#39;Model 1 mRNA&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="s1">&#39;Model 1 Protein&#39;</span><span class="p">},</span>
               <span class="p">}</span>
<span class="n">labels</span>      <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;Scenario 1&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;Scenario 2&#39;</span><span class="p">}</span>
               <span class="p">}</span>

<span class="n">figs</span><span class="p">,</span> <span class="n">AX</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">plot_index</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">titles</span><span class="o">=</span><span class="n">titles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/_Example_2nb_12_0.png" src="_images/_Example_2nb_12_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/_Example_2nb_12_1.png" src="_images/_Example_2nb_12_1.png" />
</div>
</div>
</div>
<div class="section" id="Plotting-extra-variables">
<h2>Plotting extra variables<a class="headerlink" href="#Plotting-extra-variables" title="Permalink to this headline">¶</a></h2>
<p>Sometimes, we might want to examine quantities that are not time series of the state variables. In this case, we can come up with our own functions to evaluate extra variables. This extra function takes of the form of func(y, t, params). The arrays in ym and their corresponding rows in params are fed into this function. The return values are:</p>
<ol class="arabic simple">
<li><p>The y axis values</p></li>
<li><p>The x axis values</p></li>
<li><p>The marker used for plotting (Refer to matplotlib)</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">synthesis_p</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    filler</span>
<span class="sd">    x: Time</span>
<span class="sd">    y: synthesis_rate</span>
<span class="sd">    filler</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">synp</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">synthesis_rate</span> <span class="o">=</span> <span class="n">synp</span><span class="o">*</span><span class="n">m</span>

    <span class="k">return</span> <span class="n">synthesis_rate</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span>

<span class="n">ym</span><span class="p">,</span> <span class="n">em</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">integrate_models</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">synthesis_p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulating models
Simulation complete
</pre></div></div>
</div>
<p>Note that em is a nested dictinary in the form em[function][model_num][scenario_num][row]</p>
<p>To plot the synthesis rate, modify the plot settings accordingly.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_index</span>  <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">synthesis_p</span><span class="p">],</span>
               <span class="p">}</span>
<span class="n">titles</span>      <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="s1">&#39;Model 1 Protein&#39;</span><span class="p">,</span> <span class="n">synthesis_p</span><span class="p">:</span> <span class="s1">&#39;Rate of Protein Synthesis&#39;</span><span class="p">},</span>
               <span class="p">}</span>
<span class="n">labels</span>      <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;Scenario 1&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;Scenario 2&#39;</span><span class="p">}</span>
               <span class="p">}</span>

<span class="n">figs</span><span class="p">,</span> <span class="n">AX</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">plot_index</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="n">em</span><span class="p">,</span> <span class="n">titles</span><span class="o">=</span><span class="n">titles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/_Example_2nb_17_0.png" src="_images/_Example_2nb_17_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/_Example_2nb_17_1.png" src="_images/_Example_2nb_17_1.png" />
</div>
</div>
<p>Finally, we can export the data for our external analysis in csv format.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Prefix at the front of the filenames</span>
<span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="c1">#A new folder will be created using this directory. The files will be stored here.</span>
<span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span> <span class="o">/</span> <span class="s1">&#39;simulation_results&#39;</span>

<span class="n">sim</span><span class="o">.</span><span class="n">export_simulation_results</span><span class="p">(</span><span class="n">ym</span><span class="p">,</span> <span class="n">em</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;y_1_1_0.csv&#39;,
 &#39;y_1_2_1.csv&#39;,
 &#39;synthesis_p_1_1_0.csv&#39;,
 &#39;synthesis_p_1_2_1.csv&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;simulation_results/y_1_1_0.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>Time</th>
      <th>m</th>
      <th>p</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>10.0</td>
      <td>0.000083</td>
      <td>0.000004</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>20.0</td>
      <td>0.000154</td>
      <td>0.000015</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>30.0</td>
      <td>0.000215</td>
      <td>0.000031</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>40.0</td>
      <td>0.000267</td>
      <td>0.000050</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>56</th>
      <td>56</td>
      <td>560.0</td>
      <td>0.000592</td>
      <td>0.000491</td>
    </tr>
    <tr>
      <th>57</th>
      <td>57</td>
      <td>570.0</td>
      <td>0.000592</td>
      <td>0.000492</td>
    </tr>
    <tr>
      <th>58</th>
      <td>58</td>
      <td>580.0</td>
      <td>0.000592</td>
      <td>0.000492</td>
    </tr>
    <tr>
      <th>59</th>
      <td>59</td>
      <td>590.0</td>
      <td>0.000593</td>
      <td>0.000492</td>
    </tr>
    <tr>
      <th>60</th>
      <td>60</td>
      <td>600.0</td>
      <td>0.000593</td>
      <td>0.000492</td>
    </tr>
  </tbody>
</table>
<p>61 rows × 4 columns</p>
</div></div>
</div>
</div>
<div class="section" id="Piecewise-Integration">
<h2>Piecewise Integration<a class="headerlink" href="#Piecewise-Integration" title="Permalink to this headline">¶</a></h2>
<p>BMSS2 also allows piecewise integration where the tspan field is broken into multiple lists. For example, a list of [0, 100, 11] could be broken in to <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">50,</span> <span class="pre">6],</span> <span class="pre">[50,</span> <span class="pre">100,</span> <span class="pre">6]</span></code>. The user can define a custom function in their Python script to be passed into BMSS under the “modify_init” or “modify_param” argument which will modify the states or parameters between segments.</p>
<p>Supposed the inducer is added at a certain time point. We can simulate this by:</p>
<ol class="arabic simple">
<li><p>Breaking the tspan argument into segments</p></li>
<li><p>Adding a modify_param</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">change_inducer_by_scenario_and_segment</span><span class="p">(</span><span class="n">init_values</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">model_num</span><span class="p">,</span> <span class="n">scenario_num</span><span class="p">,</span> <span class="n">segment</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Modifies the the current array of params based on model_num, scenario, segment and init_values.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">new_params</span>   <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">model_num</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">segment</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">scenario_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">new_params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">8e-2</span>

        <span class="k">return</span> <span class="n">new_params</span>
</pre></div>
</div>
</div>
<p>Now we import the settings</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[TestModel, Dummy]

init =
    m   = [0],
    p   = [0]

parameter_values =
    k_ind = [1e-2],
    synm  = [1e-5],
    degm  = [0.015],
    synp  = [1e-2],
    degp  = [0.012],
    ind   = [0]

units =
    k_ind = % Arabinose,
    synm  = M/min,
    degm  = 1/min,
    synp  = M/min,
    degp  = 1/min,
    ind   = % Arabinose

tspan =
    [0, 300, 31], [300, 600, 31]
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;settings_sim_2.ini&#39;</span>
<span class="n">models</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">config_data</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">get_models_and_params</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="c1">#Print tspan</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tspan for two-segment experiment&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">models</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;tspan&#39;</span><span class="p">])</span>

<span class="c1">#Modify models accordingly</span>
<span class="n">models</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;int_args&#39;</span><span class="p">][</span><span class="s1">&#39;modify_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">change_inducer_by_scenario_and_segment</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Tspan for two-segment experiment
[array([  0.,  10.,  20.,  30.,  40.,  50.,  60.,  70.,  80.,  90., 100.,
       110., 120., 130., 140., 150., 160., 170., 180., 190., 200., 210.,
       220., 230., 240., 250., 260., 270., 280., 290., 300.]), array([300., 310., 320., 330., 340., 350., 360., 370., 380., 390., 400.,
       410., 420., 430., 440., 450., 460., 470., 480., 490., 500., 510.,
       520., 530., 540., 550., 560., 570., 580., 590., 600.])]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Integrate</span>
<span class="n">ym</span><span class="p">,</span> <span class="n">em</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">integrate_models</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">synthesis_p</span><span class="p">)</span>

<span class="n">figs</span><span class="p">,</span> <span class="n">AX</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">plot_index</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="n">em</span><span class="p">,</span> <span class="n">titles</span><span class="o">=</span><span class="n">titles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulating models
Simulation complete
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/_Example_2nb_25_1.png" src="_images/_Example_2nb_25_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/_Example_2nb_25_2.png" src="_images/_Example_2nb_25_2.png" />
</div>
</div>
<p>Note that the initial values can also be modified in a similar manner. Write your own function and place it under models[model_num][‘int_args’][‘modify_init’] instead.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="_Example_3nb.html" class="btn btn-neutral float-right" title="3. Making a Model Selection Workflow" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="_Example_1nb.html" class="btn btn-neutral float-left" title="1. Using the Database and Config Files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Russell Ngo Jie Kai

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>